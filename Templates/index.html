<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Game Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar for Filters -->
            <div class="col-md-3">
        <div class="sidebar">
                    <!-- Studio Performance Filters -->
                    <div id="studio-filters">
                        <h3>Studio Performance Filters</h3>
                        <form id="studio-filter-form" method="GET" action="/">
                            <input type="hidden" name="tab" value="studio">
                         <div class="mb-3">
                            <label for="genre-filter" class="form-label">Select Genre(s)</label>
                            <select class="form-select" id="genre-filter" name="genre" multiple>
                    {% for genre in all_genres %}
                                    <option value="{{ genre }}" {% if genre in selected_genres %}selected{% endif %}>{{ genre }}</option>
                    {% endfor %}
                </select>
            </div>

                        <div class="mb-3">
                            <label for="platform-filter" class="form-label">Select Platform(s)</label>
                            <select class="form-select" id="platform-filter" name="platform" multiple>
                    {% for platform in all_platforms %}
                                    <option value="{{ platform }}" {% if platform in selected_platforms %}selected{% endif %}>{{ platform }}</option>
                    {% endfor %}
                </select>
            </div>

                         <div class="slider-container">
                                <label for="year-range" class="form-label">Release Year Range: <span id="year-range-display">{{ year_range[0] | default(min_year) }} - {{ year_range[1] | default(max_year) }}</span></label>
                              <input type="range" class="form-range" id="year-start" name="year_start" min="{{ min_year }}" max="{{ max_year }}" value="{{ year_range[0] | default(min_year) }}">
                              <input type="range" class="form-range" id="year-end" name="year_end" min="{{ min_year }}" max="{{ max_year }}" value="{{ year_range[1] | default(max_year) }}">
                         </div>

                        <button type="submit" class="btn btn-primary">Apply Filters</button>
                    </form>
                    </div>

                    <!-- Operational Dashboard Filters -->
                    <div id="operational-filters" style="display: none;">
                        <h3>Game Release & Ratings Activity Filters</h3>
                        <form id="operational-filter-form" method="GET" action="/">
                            <input type="hidden" name="tab" value="operational">
                            
                            <div class="mb-3">
                                <label for="op-year-filter" class="form-label">Select Year(s)</label>
                                <select class="form-select" id="op-year-filter" name="op_years" multiple size="5">
                                    {% for year in range(max_year, min_year - 1, -1) %}
                                        <option value="{{ year }}" {% if request.args.getlist('op_years') and year|string in request.args.getlist('op_years') %}selected{% endif %}>{{ year }}</option>
                                    {% endfor %}
                                </select>
                                <small class="text-muted">Hold Ctrl/Cmd to select multiple years</small>
                            </div>

                            <div class="mb-3">
                                <label for="op-month-filter" class="form-label">Select Month(s)</label>
                                <select class="form-select" id="op-month-filter" name="op_months" multiple size="6">
                                    <option value="1" {% if request.args.getlist('op_months') and '1' in request.args.getlist('op_months') %}selected{% endif %}>January</option>
                                    <option value="2" {% if request.args.getlist('op_months') and '2' in request.args.getlist('op_months') %}selected{% endif %}>February</option>
                                    <option value="3" {% if request.args.getlist('op_months') and '3' in request.args.getlist('op_months') %}selected{% endif %}>March</option>
                                    <option value="4" {% if request.args.getlist('op_months') and '4' in request.args.getlist('op_months') %}selected{% endif %}>April</option>
                                    <option value="5" {% if request.args.getlist('op_months') and '5' in request.args.getlist('op_months') %}selected{% endif %}>May</option>
                                    <option value="6" {% if request.args.getlist('op_months') and '6' in request.args.getlist('op_months') %}selected{% endif %}>June</option>
                                    <option value="7" {% if request.args.getlist('op_months') and '7' in request.args.getlist('op_months') %}selected{% endif %}>July</option>
                                    <option value="8" {% if request.args.getlist('op_months') and '8' in request.args.getlist('op_months') %}selected{% endif %}>August</option>
                                    <option value="9" {% if request.args.getlist('op_months') and '9' in request.args.getlist('op_months') %}selected{% endif %}>September</option>
                                    <option value="10" {% if request.args.getlist('op_months') and '10' in request.args.getlist('op_months') %}selected{% endif %}>October</option>
                                    <option value="11" {% if request.args.getlist('op_months') and '11' in request.args.getlist('op_months') %}selected{% endif %}>November</option>
                                    <option value="12" {% if request.args.getlist('op_months') and '12' in request.args.getlist('op_months') %}selected{% endif %}>December</option>
                                </select>
                                <small class="text-muted">Hold Ctrl/Cmd to select multiple months</small>
                            </div>

                            <div class="mb-3">
                                <label for="op-rating-filter" class="form-label">Minimum Rating</label>
                                <select class="form-select" id="op-rating-filter" name="op_min_rating">
                                    <option value="" {% if not request.args.get('op_min_rating') %}selected{% endif %}>Any Rating</option>
                                    <option value="5" {% if request.args.get('op_min_rating') == '5' %}selected{% endif %}>5.0+</option>
                                    <option value="6" {% if request.args.get('op_min_rating') == '6' %}selected{% endif %}>6.0+</option>
                                    <option value="7" {% if request.args.get('op_min_rating') == '7' %}selected{% endif %}>7.0+</option>
                                    <option value="8" {% if request.args.get('op_min_rating') == '8' %}selected{% endif %}>8.0+</option>
                                    <option value="9" {% if request.args.get('op_min_rating') == '9' %}selected{% endif %}>9.0+</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="op-timeframe" class="form-label">Analysis Timeframe</label>
                                <select class="form-select" id="op-timeframe" name="op_timeframe">
                                    <option value="all" {% if request.args.get('op_timeframe') == 'all' %}selected{% endif %}>All Time</option>
                                    <option value="recent" {% if not request.args.get('op_timeframe') or request.args.get('op_timeframe') == 'recent' %}selected{% endif %}>Recent (Last 5 Years)</option>
                                    <option value="last_decade" {% if request.args.get('op_timeframe') == 'last_decade' %}selected{% endif %}>Last Decade</option>
                                    <option value="custom" {% if request.args.get('op_timeframe') == 'custom' %}selected{% endif %}>Custom Range (Use Year Selection)</option>
                                </select>
                                <small class="text-muted">Custom Range uses your selected years above</small>
                            </div>

                            <button type="submit" class="btn btn-primary">Apply Filters</button>
                            <button type="button" class="btn btn-secondary mt-2" id="reset-op-filters">Reset Filters</button>
                        </form>
                    </div>

                    <!-- Tactical Dashboard Filters -->
                    <div id="tactical-filters" style="display: none;">
                        <h3>Developer Performance Filters</h3>
                        <form id="tactical-filter-form" method="GET" action="/">
                            <input type="hidden" name="tab" value="tactical">
                            
                            <div class="mb-3">
                                <label for="tactical-year-range" class="form-label">Release Year Range: <span id="tactical-year-range-display">{{ year_range[0] | default(min_year) }} - {{ year_range[1] | default(max_year) }}</span></label>
                                <input type="range" class="form-range" id="tactical-year-start" name="tactical_year_start" min="{{ min_year }}" max="{{ max_year }}" value="{{ request.args.get('tactical_year_start', year_range[0] | default(min_year)) }}">
                                <input type="range" class="form-range" id="tactical-year-end" name="tactical_year_end" min="{{ min_year }}" max="{{ max_year }}" value="{{ request.args.get('tactical_year_end', year_range[1] | default(max_year)) }}">
                            </div>

                            <div class="mb-3">
                                <label for="tactical-studio-type" class="form-label">Studio Type</label>
                                <select class="form-select" id="tactical-studio-type" name="tactical_studio_types" multiple size="6">
                                    <option value="all_studios" {% if not request.args.getlist('tactical_studio_types') or 'all_studios' in request.args.getlist('tactical_studio_types') %}selected{% endif %}>üåü All Studios</option>
                                    <option value="AAA" {% if request.args.getlist('tactical_studio_types') and 'AAA' in request.args.getlist('tactical_studio_types') %}selected{% endif %}>AAA Studios</option>
                                    <option value="Mid-tier" {% if request.args.getlist('tactical_studio_types') and 'Mid-tier' in request.args.getlist('tactical_studio_types') %}selected{% endif %}>Mid-tier Studios</option>
                                    <option value="Indie" {% if request.args.getlist('tactical_studio_types') and 'Indie' in request.args.getlist('tactical_studio_types') %}selected{% endif %}>Indie Studios</option>
                                    <option value="Mobile" {% if request.args.getlist('tactical_studio_types') and 'Mobile' in request.args.getlist('tactical_studio_types') %}selected{% endif %}>Mobile Studios</option>
                                    <option value="Legacy" {% if request.args.getlist('tactical_studio_types') and 'Legacy' in request.args.getlist('tactical_studio_types') %}selected{% endif %}>Legacy Studios</option>
                                </select>
                                <small class="text-muted">Hold Ctrl/Cmd to select multiple types</small>
                                <div class="mt-1">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectMajorStudios()">Major Studios</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectAllStudios()">All</button>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="tactical-country-filter" class="form-label">Developer Country</label>
                                <select class="form-select" id="tactical-country-filter" name="tactical_countries" multiple size="7">
                                    <option value="all_countries" {% if not request.args.getlist('tactical_countries') or 'all_countries' in request.args.getlist('tactical_countries') %}selected{% endif %}>üåç All Countries</option>
                                    <option value="United States" {% if request.args.getlist('tactical_countries') and 'United States' in request.args.getlist('tactical_countries') %}selected{% endif %}>United States</option>
                                    <option value="Japan" {% if request.args.getlist('tactical_countries') and 'Japan' in request.args.getlist('tactical_countries') %}selected{% endif %}>Japan</option>
                                    <option value="United Kingdom" {% if request.args.getlist('tactical_countries') and 'United Kingdom' in request.args.getlist('tactical_countries') %}selected{% endif %}>United Kingdom</option>
                                    <option value="Canada" {% if request.args.getlist('tactical_countries') and 'Canada' in request.args.getlist('tactical_countries') %}selected{% endif %}>Canada</option>
                                    <option value="Germany" {% if request.args.getlist('tactical_countries') and 'Germany' in request.args.getlist('tactical_countries') %}selected{% endif %}>Germany</option>
                                    <option value="France" {% if request.args.getlist('tactical_countries') and 'France' in request.args.getlist('tactical_countries') %}selected{% endif %}>France</option>
                                    <option value="Sweden" {% if request.args.getlist('tactical_countries') and 'Sweden' in request.args.getlist('tactical_countries') %}selected{% endif %}>Sweden</option>
                                    <option value="Finland" {% if request.args.getlist('tactical_countries') and 'Finland' in request.args.getlist('tactical_countries') %}selected{% endif %}>Finland</option>
                                </select>
                                <small class="text-muted">Hold Ctrl/Cmd to select multiple countries</small>
                                <div class="mt-1">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectTopCountries()">Top 5</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectAllCountries()">All</button>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="tactical-maturity-filter" class="form-label">Developer Maturity</label>
                                <select class="form-select" id="tactical-maturity-filter" name="tactical_maturity" multiple size="4">
                                    <option value="all_maturity" {% if not request.args.getlist('tactical_maturity') or 'all_maturity' in request.args.getlist('tactical_maturity') %}selected{% endif %}>‚≠ê All Maturity Levels</option>
                                    <option value="Veteran" {% if request.args.getlist('tactical_maturity') and 'Veteran' in request.args.getlist('tactical_maturity') %}selected{% endif %}>Veteran (30+ years)</option>
                                    <option value="Established" {% if request.args.getlist('tactical_maturity') and 'Established' in request.args.getlist('tactical_maturity') %}selected{% endif %}>Established (15-29 years)</option>
                                    <option value="Emerging" {% if request.args.getlist('tactical_maturity') and 'Emerging' in request.args.getlist('tactical_maturity') %}selected{% endif %}>Emerging (0-14 years)</option>
                                </select>
                                <small class="text-muted">Hold Ctrl/Cmd to select multiple levels</small>
                            </div>

                            <div class="mb-3">
                                <label for="tactical-performance-tier" class="form-label">Performance Tier</label>
                                <select class="form-select" id="tactical-performance-tier" name="tactical_performance_tiers" multiple size="6">
                                    <option value="all_performance_tiers" {% if not request.args.getlist('tactical_performance_tiers') or 'all_performance_tiers' in request.args.getlist('tactical_performance_tiers') %}selected{% endif %}>üèÜ All Performance Tiers</option>
                                    <option value="Elite" {% if request.args.getlist('tactical_performance_tiers') and 'Elite' in request.args.getlist('tactical_performance_tiers') %}selected{% endif %}>ü•á Elite (75%+ replay rate)</option>
                                    <option value="High" {% if request.args.getlist('tactical_performance_tiers') and 'High' in request.args.getlist('tactical_performance_tiers') %}selected{% endif %}>ü•à High (65-74% replay rate)</option>
                                    <option value="Medium" {% if request.args.getlist('tactical_performance_tiers') and 'Medium' in request.args.getlist('tactical_performance_tiers') %}selected{% endif %}>ü•â Medium (55-64% replay rate)</option>
                                    <option value="Developing" {% if request.args.getlist('tactical_performance_tiers') and 'Developing' in request.args.getlist('tactical_performance_tiers') %}selected{% endif %}>üìà Developing (45-54% replay rate)</option>
                                    <option value="Emerging" {% if request.args.getlist('tactical_performance_tiers') and 'Emerging' in request.args.getlist('tactical_performance_tiers') %}selected{% endif %}>üå± Emerging (<45% replay rate)</option>
                                </select>
                                <small class="text-muted">Filter by performance tier based on replay rates</small>
                                <div class="mt-1">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectTopPerformers()">Top Performers</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectAllPerformanceTiers()">All</button>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="tactical-years-active" class="form-label">Years Active</label>
                                <select class="form-select" id="tactical-years-active" name="tactical_years_active" multiple size="6">
                                    <option value="all_years_active" {% if not request.args.getlist('tactical_years_active') or 'all_years_active' in request.args.getlist('tactical_years_active') %}selected{% endif %}>‚è∞ All Experience Levels</option>
                                    <option value="30+ years" {% if request.args.getlist('tactical_years_active') and '30+ years' in request.args.getlist('tactical_years_active') %}selected{% endif %}>üèõÔ∏è Veteran (30+ years)</option>
                                    <option value="20-29 years" {% if request.args.getlist('tactical_years_active') and '20-29 years' in request.args.getlist('tactical_years_active') %}selected{% endif %}>üè¢ Established (20-29 years)</option>
                                    <option value="10-19 years" {% if request.args.getlist('tactical_years_active') and '10-19 years' in request.args.getlist('tactical_years_active') %}selected{% endif %}>üöÄ Mature (10-19 years)</option>
                                    <option value="5-9 years" {% if request.args.getlist('tactical_years_active') and '5-9 years' in request.args.getlist('tactical_years_active') %}selected{% endif %}>üí° Growing (5-9 years)</option>
                                    <option value="0-4 years" {% if request.args.getlist('tactical_years_active') and '0-4 years' in request.args.getlist('tactical_years_active') %}selected{% endif %}>üåü New (0-4 years)</option>
                                </select>
                                <small class="text-muted">Filter by years of industry experience</small>
                                <div class="mt-1">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectExperiencedDevelopers()">Experienced</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectAllYearsActive()">All</button>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="tactical-replay-rate-ranges" class="form-label">Replay Rate Range</label>
                                <select class="form-select" id="tactical-replay-rate-ranges" name="tactical_replay_rate_ranges" multiple size="7">
                                    <option value="all_replay_rates" {% if not request.args.getlist('tactical_replay_rate_ranges') or 'all_replay_rates' in request.args.getlist('tactical_replay_rate_ranges') %}selected{% endif %}>üìä All Replay Rates</option>
                                    <option value="90-100%" {% if request.args.getlist('tactical_replay_rate_ranges') and '90-100%' in request.args.getlist('tactical_replay_rate_ranges') %}selected{% endif %}>üî• Exceptional (90-100%)</option>
                                    <option value="80-89%" {% if request.args.getlist('tactical_replay_rate_ranges') and '80-89%' in request.args.getlist('tactical_replay_rate_ranges') %}selected{% endif %}>‚≠ê Excellent (80-89%)</option>
                                    <option value="70-79%" {% if request.args.getlist('tactical_replay_rate_ranges') and '70-79%' in request.args.getlist('tactical_replay_rate_ranges') %}selected{% endif %}>üëç Good (70-79%)</option>
                                    <option value="60-69%" {% if request.args.getlist('tactical_replay_rate_ranges') and '60-69%' in request.args.getlist('tactical_replay_rate_ranges') %}selected{% endif %}>üìà Average (60-69%)</option>
                                    <option value="50-59%" {% if request.args.getlist('tactical_replay_rate_ranges') and '50-59%' in request.args.getlist('tactical_replay_rate_ranges') %}selected{% endif %}>üìâ Below Average (50-59%)</option>
                                    <option value="Below 50%" {% if request.args.getlist('tactical_replay_rate_ranges') and 'Below 50%' in request.args.getlist('tactical_replay_rate_ranges') %}selected{% endif %}>‚ö†Ô∏è Poor (Below 50%)</option>
                                </select>
                                <small class="text-muted">Filter by specific replay rate performance ranges</small>
                                <div class="mt-1">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectHighReplayRates()">High Rates</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectAllReplayRates()">All</button>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="tactical-developer-sizes" class="form-label">Developer Size Category</label>
                                <select class="form-select" id="tactical-developer-sizes" name="tactical_developer_sizes" multiple size="5">
                                    <option value="all_developer_sizes" {% if not request.args.getlist('tactical_developer_sizes') or 'all_developer_sizes' in request.args.getlist('tactical_developer_sizes') %}selected{% endif %}>üè≠ All Developer Sizes</option>
                                    <option value="Large (AAA)" {% if request.args.getlist('tactical_developer_sizes') and 'Large (AAA)' in request.args.getlist('tactical_developer_sizes') %}selected{% endif %}>üè¢ Large (AAA Studios)</option>
                                    <option value="Medium (Mid-tier)" {% if request.args.getlist('tactical_developer_sizes') and 'Medium (Mid-tier)' in request.args.getlist('tactical_developer_sizes') %}selected{% endif %}>üè¨ Medium (Mid-tier Studios)</option>
                                    <option value="Small (Indie)" {% if request.args.getlist('tactical_developer_sizes') and 'Small (Indie)' in request.args.getlist('tactical_developer_sizes') %}selected{% endif %}>üè™ Small (Indie Studios)</option>
                                    <option value="Specialized (Mobile/Legacy)" {% if request.args.getlist('tactical_developer_sizes') and 'Specialized (Mobile/Legacy)' in request.args.getlist('tactical_developer_sizes') %}selected{% endif %}>üì± Specialized (Mobile/Legacy)</option>
                                </select>
                                <small class="text-muted">Filter by developer organization size and focus</small>
                                <div class="mt-1">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectLargeStudios()">Large Studios</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectAllDeveloperSizes()">All</button>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="tactical-analysis-type" class="form-label">Analysis Focus</label>
                                <select class="form-select" id="tactical-analysis-type" name="tactical_analysis">
                                    <option value="performance_overview" {% if not request.args.get('tactical_analysis') or request.args.get('tactical_analysis') == 'performance_overview' %}selected{% endif %}>Performance Overview</option>
                                    <option value="geographic_analysis" {% if request.args.get('tactical_analysis') == 'geographic_analysis' %}selected{% endif %}>Geographic Analysis</option>
                                    <option value="studio_comparison" {% if request.args.get('tactical_analysis') == 'studio_comparison' %}selected{% endif %}>Studio Type Comparison</option>
                                    <option value="maturity_insights" {% if request.args.get('tactical_analysis') == 'maturity_insights' %}selected{% endif %}>Maturity Insights</option>
                                </select>
                                <small class="text-muted">Choose your developer analysis focus</small>
                            </div>

                            <button type="submit" class="btn btn-primary">Apply Filters</button>
                            <button type="button" class="btn btn-secondary mt-2" id="reset-tactical-filters">Reset Filters</button>
                        </form>
                    </div>

                    <!-- Analytical Lifecycle Dashboard Filters -->
                    <div id="lifecycle-filters" style="display: none;">
                        <h3>üìä Game Lifecycle Filters</h3>
                        <form id="lifecycle-filter-form" method="GET" action="/">
                            <input type="hidden" name="tab" value="analytical-lifecycle">
                            
                            <div class="mb-3">
                                <label for="lifecycle-search" class="form-label">Search Game Title</label>
                                <input type="text" class="form-control" id="lifecycle-search" name="search_term" value="{{ request.args.get('search_term', '') }}" placeholder="Enter game name...">
                                <small class="text-muted">Search for specific games to analyze</small>
                            </div>

                            <div class="mb-3">
                                <label for="lifecycle-genre-filter" class="form-label">Genre(s)</label>
                                <select class="form-select" id="lifecycle-genre-filter" name="lifecycle_genres" multiple size="5">
                                    {% for genre in all_genres[:12] %}
                                        <option value="{{ genre }}" {% if request.args.getlist('lifecycle_genres') and genre in request.args.getlist('lifecycle_genres') %}selected{% endif %}>{{ genre }}</option>
                                    {% endfor %}
                                </select>
                                <small class="text-muted">Hold Ctrl/Cmd to select multiple</small>
                            </div>

                            <div class="mb-3">
                                <label for="lifecycle-platform-filter" class="form-label">Platform(s)</label>
                                <select class="form-select" id="lifecycle-platform-filter" name="lifecycle_platforms" multiple size="5">
                                    {% for platform in all_platforms[:12] %}
                                        <option value="{{ platform }}" {% if request.args.getlist('lifecycle_platforms') and platform in request.args.getlist('lifecycle_platforms') %}selected{% endif %}>{{ platform }}</option>
                                    {% endfor %}
                                </select>
                                <small class="text-muted">Hold Ctrl/Cmd to select multiple</small>
                            </div>

                            <div class="mb-3">
                                <label for="lifecycle-min-rating" class="form-label">Minimum Rating: <span id="lifecycle-rating-display">{{ request.args.get('min_rating', '0.0') }}</span></label>
                                <input type="range" class="form-range" id="lifecycle-min-rating" name="min_rating" min="0" max="10" step="0.1" value="{{ request.args.get('min_rating', '0.0') }}">
                            </div>

                            <div class="mb-3">
                                <label for="lifecycle-min-votes" class="form-label">Minimum Votes: <span id="lifecycle-votes-display">{{ request.args.get('min_votes', '0') }}</span></label>
                                <input type="range" class="form-range" id="lifecycle-min-votes" name="min_votes" min="0" max="10000" step="100" value="{{ request.args.get('min_votes', '0') }}">
                            </div>

                            <div class="mb-3">
                                <label for="lifecycle-game-type" class="form-label">Game Type</label>
                                <select class="form-select" id="lifecycle-game-type" name="game_type">
                                    <option value="" {% if not request.args.get('game_type') %}selected{% endif %}>All Types</option>
                                    <option value="Single-player" {% if request.args.get('game_type') == 'Single-player' %}selected{% endif %}>Single-player</option>
                                    <option value="Multiplayer" {% if request.args.get('game_type') == 'Multiplayer' %}selected{% endif %}>Multiplayer</option>
                                    <option value="Co-op" {% if request.args.get('game_type') == 'Co-op' %}selected{% endif %}>Co-op</option>
                                </select>
                            </div>

                            <button type="submit" class="btn btn-primary">Apply Filters</button>
                            <button type="button" class="btn btn-secondary mt-2" id="reset-lifecycle-filters">Reset Filters</button>
                        </form>
                    </div>

                    <!-- Analytical Evolution Dashboard Filters -->
                    <div id="evolution-filters" style="display: none;">
                        <h3>üß† Genre Evolution Filters</h3>
                        <form id="evolution-filter-form" method="GET" action="/">
                            <input type="hidden" name="tab" value="analytical-evolution">
                            
                            <div class="mb-3">
                                <label for="evolution-genre-filter" class="form-label">Focus Genre(s)</label>
                                <select class="form-select" id="evolution-genre-filter" name="evolution_genres" multiple size="6">
                                    {% for genre in all_genres[:15] %}
                                        <option value="{{ genre }}" {% if request.args.getlist('evolution_genres') and genre in request.args.getlist('evolution_genres') %}selected{% endif %}>{{ genre }}</option>
                                    {% endfor %}
                                </select>
                                <small class="text-muted">Hold Ctrl/Cmd to select multiple genres</small>
                                <div class="mt-1">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectEvolutionGenres()">Core Genres</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="clearEvolutionGenres()">Clear</button>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="evolution-platform-filter" class="form-label">Platform Evolution</label>
                                <select class="form-select" id="evolution-platform-filter" name="evolution_platforms" multiple size="5">
                                    {% for platform in all_platforms[:12] %}
                                        <option value="{{ platform }}" {% if request.args.getlist('evolution_platforms') and platform in request.args.getlist('evolution_platforms') %}selected{% endif %}>{{ platform }}</option>
                                    {% endfor %}
                                </select>
                                <small class="text-muted">Track platform-specific evolution</small>
                            </div>

                            <div class="mb-3">
                                <label for="evolution-time-period" class="form-label">Evolution Time Period</label>
                                <select class="form-select" id="evolution-time-period" name="evolution_period">
                                    <option value="all_time" {% if not request.args.get('evolution_period') or request.args.get('evolution_period') == 'all_time' %}selected{% endif %}>All Time Evolution</option>
                                    <option value="modern_era" {% if request.args.get('evolution_period') == 'modern_era' %}selected{% endif %}>Modern Era (2000+)</option>
                                    <option value="recent_decade" {% if request.args.get('evolution_period') == 'recent_decade' %}selected{% endif %}>Recent Decade</option>
                                    <option value="by_generation" {% if request.args.get('evolution_period') == 'by_generation' %}selected{% endif %}>By Console Generation</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="evolution-metric" class="form-label">Primary Evolution Metric</label>
                                <select class="form-select" id="evolution-metric" name="evolution_metric">
                                    <option value="rating_trends" {% if not request.args.get('evolution_metric') or request.args.get('evolution_metric') == 'rating_trends' %}selected{% endif %}>Rating Trends</option>
                                    <option value="popularity_growth" {% if request.args.get('evolution_metric') == 'popularity_growth' %}selected{% endif %}>Popularity Growth</option>
                                    <option value="platform_adoption" {% if request.args.get('evolution_metric') == 'platform_adoption' %}selected{% endif %}>Platform Adoption</option>
                                    <option value="publisher_behavior" {% if request.args.get('evolution_metric') == 'publisher_behavior' %}selected{% endif %}>Publisher Behavior</option>
                                </select>
                            </div>

                            <button type="submit" class="btn btn-primary">Apply Filters</button>
                            <button type="button" class="btn btn-secondary mt-2" id="reset-evolution-filters">Reset Filters</button>
                        </form>
                    </div>
                </div>
        </div>

            <!-- Main Content Area -->
            <div class="col-md-9">
        <div class="main-content">
                    <h1 class="text-center my-4">Gaming Analytics Dashboard</h1>

                    {% if error %}
                        <div class="alert alert-danger" role="alert">
                            Error: {{ error }}
                        </div>
                    {% endif %}

                    <!-- Tab Navigation -->
                    <ul class="nav nav-tabs mb-4" id="dashboardTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link {% if active_tab == 'studio' %}active{% endif %}" id="studio-tab" data-bs-toggle="tab" data-bs-target="#studio-performance" data-tab="studio" type="button" role="tab">
                                Studio Performance
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link {% if active_tab == 'operational' %}active{% endif %}" id="operational-tab" data-bs-toggle="tab" data-bs-target="#operational-dashboard" data-tab="operational" type="button" role="tab">
                                Release Activity
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link {% if active_tab == 'tactical' %}active{% endif %}" id="tactical-tab" data-bs-toggle="tab" data-bs-target="#tactical-dashboard" data-tab="tactical" type="button" role="tab">
                                Developer Performance
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link {% if active_tab == 'game-trends' %}active{% endif %}" id="game-trends-tab" data-bs-toggle="tab" data-bs-target="#game-trends-dashboard" data-tab="game-trends" type="button" role="tab">
                                Game Trends
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link {% if active_tab == 'pixel-profits' %}active{% endif %}" id="pixel-profits-tab" data-bs-toggle="tab" data-bs-target="#pixel-profits-dashboard" data-tab="pixel-profits" type="button" role="tab">
                                Pixel Profits
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content" id="dashboardTabContent">
                        <!-- Studio Performance Tab -->
                        <div class="tab-pane fade {% if active_tab == 'studio' %}show active{% endif %}" id="studio-performance" role="tabpanel">
                    <!-- Key Insights Row -->
                            <div class="row justify-content-center">
                        <!-- Total Games Card -->
                        <div class="col-md-3">
                                    <div class="card" style="min-height: 200px;">
                                <h5 class="card-title">Total Games Analyzed</h5>
                                <div class="big-number">{{ stats.total_games | default(0) }}</div>
                            </div>
                    </div>

                        <!-- Top Publisher Card -->
                         <div class="col-md-3">
                                    <div class="card" style="min-height: 200px;">
                                <h5 class="card-title">Top Publisher</h5>
                                        {% set filtered_publishers = [] %}
                                        {% for publisher in publisher_counts %}
                                            {% set pub_name = publisher._id | string | lower | trim %}
                                            {% if pub_name not in ['none', 'null', '', 'undefined', 'n/a', 'unknown', 'other'] %}
                                                {% set _ = filtered_publishers.append(publisher) %}
                                            {% endif %}
                                        {% endfor %}
                                        {% if filtered_publishers and filtered_publishers[0] %}
                                            <div class="big-number">{{ filtered_publishers[0]._id }}</div>
                                            <p class="text-center text-muted">{{ filtered_publishers[0].count }} games</p>
                                 {% else %}
                                     <p class="text-center text-muted">No publisher data available.</p>
                                 {% endif %}
                    </div>
                </div>

                        <!-- Total Votes Card -->
                        <div class="col-md-3">
                                    <div class="card" style="min-height: 200px;">
                                <h5 class="card-title">Total Community Votes</h5>
                                {% if votes_analytics and votes_analytics.total_votes %}
                                    <div class="big-number">{{ "{:,}".format(votes_analytics.total_votes) }}</div>
                                    <p class="text-center text-muted">Avg: {{ votes_analytics.avg_votes_per_game | default(0) }} per game</p>
                                {% else %}
                                    <p class="text-center text-muted">No voting data available.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Most Highly Rated and Most Voted Games Row -->
                    <div class="row">
                         <!-- Most Highly Rated Games List -->
                         <div class="col-md-6">
                             <div class="card">
                                 <h5 class="card-title">Most Highly Rated Games</h5>
                                 <ul class="list-unstyled">
                                     {% for game in top_games %}
                                                <li style="color: #8be9fd;"><strong>{{ loop.index }}.</strong> {{ game.name | default('Unknown Game') }} (Rating: {{ game.rating | default(0.0) | round(1) }})</li>
                        {% else %}
                                         <li class="no-data-message">No highly rated games found.</li>
                        {% endfor %}
                    </ul>
                             </div>
                         </div>

                         <!-- Most Voted Games List -->
                         <div class="col-md-6">
                             <div class="card">
                                 <h5 class="card-title">Most Voted Games</h5>
                                 <ul class="list-unstyled">
                                     {% for game in most_voted_games %}
                                                <li style="color: #8be9fd;"><strong>{{ loop.index }}.</strong> {{ game.name | default('Unknown Game') }} ({{ "{:,}".format(game.votes) }} votes, Rating: {{ game.rating | default(0.0) }})</li>
                                     {% else %}
                                         <li class="no-data-message">No voting data found.</li>
                                     {% endfor %}
                                 </ul>
                             </div>
                         </div>
                    </div>

                    <!-- Charts Row 1 -->
                    <div class="row">
                        <!-- Games Per Year Chart -->
                        <div class="col-md-6">
                            <div class="card">
                                <h5 class="card-title">Games Released Per Year</h5>
                                <div class="chart-container">
                                <canvas id="gamesPerYearChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Game Share by Publisher Chart -->
                        <div class="col-md-6">
                            <div class="card">
                                <h5 class="card-title">Game Share by Publisher (Top 10)</h5>
                                <div class="chart-container">
                                <canvas id="publisherShareChart"></canvas>
                                </div>
                            </div>
                </div>
            </div>
                    
                    <!-- Charts Row 2 -->
                    <div class="row">
                         <!-- Game Counts by Platform Chart -->
                        <div class="col-md-6">
                            <div class="card">
                                <h5 class="card-title">Game Distribution by Platform</h5>
                                <div class="chart-container">
                                <canvas id="platformChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Game Counts by Genre Chart -->
                        <div class="col-md-6">
                            <div class="card">
                                <h5 class="card-title">Game Distribution by Genre</h5>
                                <div class="chart-container">
                                <canvas id="genreChart"></canvas>
                                </div>
                </div>
                </div>
            </div>
                    
                    <!-- Charts Row 3 -->
                     <div class="row">
                          <!-- Average Rating by Platform Chart -->
                        <div class="col-md-6">
                            <div class="card">
                                <h5 class="card-title">Average Rating by Platform (Top 10)</h5>
                                <div class="chart-container">
                                <canvas id="avgRatingPlatformChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Average Rating by Developer Chart -->
                        <div class="col-md-6">
                            <div class="card">
                                <h5 class="card-title">Average Rating by Developer (Top 10)</h5>
                                <div class="chart-container">
                                <canvas id="avgRatingDeveloperChart"></canvas>
                                </div>
                            </div>
                        </div>
            </div>

                    <!-- Enhanced Analytics Row 1 -->
                    <div class="row">
                        <!-- Game Type Distribution Chart -->
                        <div class="col-md-6">
                            <div class="card">
                                <h5 class="card-title">Game Type Distribution</h5>
                                <div class="chart-container">
                                <canvas id="gameTypeChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Rating Distribution Chart -->
                        <div class="col-md-6">
                            <div class="card">
                                <h5 class="card-title">Rating Distribution</h5>
                                <div class="chart-container">
                                <canvas id="ratingDistributionChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Analytics Row 2 -->
                    <div class="row">
                        <!-- Director Analytics Chart -->
                        <div class="col-md-12">
                            <div class="card">
                                <h5 class="card-title">Top Directors by Average Rating (Min 2 Games)</h5>
                                <div class="chart-container">
                                <canvas id="directorAnalyticsChart"></canvas>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
                     
                        <!-- Operational Dashboard Tab -->
                        <div class="tab-pane fade {% if active_tab == 'operational' %}show active{% endif %}" id="operational-dashboard" role="tabpanel">
                            <!-- Operational Metrics Row -->
                            <div class="row justify-content-center">
                                <!-- Recent Releases Count -->
                                <div class="col-md-3">
                                    <div class="card" style="min-height: 200px;">
                                        <h5 class="card-title">Releases</h5>
                                        <div class="big-number">{{ recent_releases | length }}</div>
                                        {% if active_tab == 'operational' %}
                                            {% set op_years = request.args.getlist('op_years') %}
                                            {% set op_months = request.args.getlist('op_months') %}
                                            {% if op_years %}
                                                {% if op_years | length == 1 %}
                                                    <p class="text-center text-muted">From {{ op_years[0] }}</p>
                                                {% else %}
                                                    <p class="text-center text-muted">From {{ op_years | min }}-{{ op_years | max }}</p>
                                                {% endif %}
                                            {% elif year_range and year_range[0] == year_range[1] %}
                                                <p class="text-center text-muted">From {{ year_range[0] }}</p>
                                            {% elif year_range %}
                                                <p class="text-center text-muted">From {{ year_range[0] }}-{{ year_range[1] }}</p>
                                            {% else %}
                                                <p class="text-center text-muted">Recent years</p>
                                            {% endif %}
                                        {% else %}
                                            <p class="text-center text-muted">Last 2 years</p>
                                        {% endif %}
            </div>
                                </div>

                                <!-- Average Recent Rating -->
                                <div class="col-md-3">
                                    <div class="card" style="min-height: 200px;">
                                        <h5 class="card-title">Avg Recent Rating</h5>
                                        {% if top_rated_recent %}
                                            {% set avg_recent = (top_rated_recent | map(attribute='rating') | sum) / (top_rated_recent | length) %}
                                            <div class="big-number">{{ avg_recent | round(1) }}</div>
                                        {% else %}
                                            <div class="big-number">N/A</div>
                                        {% endif %}
                                        <p class="text-center text-muted">Top rated games</p>
        </div>
    </div>

                                <!-- Active Platforms -->
                                <div class="col-md-3">
                                    <div class="card" style="min-height: 200px;">
                                        <h5 class="card-title">Active Platforms</h5>
                                        <div class="big-number">{{ platform_performance | length }}</div>
                                        <p class="text-center text-muted">With 5+ games</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Games and Platform Performance Row -->
                    <div class="row">
                                <!-- Recent Releases List -->
                                <div class="col-md-6">
                                    <div class="card">
                                        {% if active_tab == 'operational' %}
                                            {% set op_years = request.args.getlist('op_years') %}
                                            {% if op_years %}
                                                {% if op_years | length == 1 %}
                                                    <h5 class="card-title">Recent Releases from {{ op_years[0] }}</h5>
                                                {% else %}
                                                    <h5 class="card-title">Recent Releases ({{ op_years | min }}-{{ op_years | max }})</h5>
                                                {% endif %}
                                            {% elif year_range and year_range[0] == year_range[1] %}
                                                <h5 class="card-title">Recent Releases from {{ year_range[0] }}</h5>
                                            {% elif year_range %}
                                                <h5 class="card-title">Recent Releases ({{ year_range[0] }}-{{ year_range[1] }})</h5>
                                            {% else %}
                                                <h5 class="card-title">Recent Releases</h5>
                                            {% endif %}
                                        {% else %}
                                            <h5 class="card-title">Recent Releases</h5>
                                        {% endif %}
                                        <div style="max-height: 300px; overflow-y: auto;">
                                            <ul class="list-unstyled">
                                                {% for game in recent_releases[:15] %}
                                                    <li style="color: #8be9fd; font-size: 0.85rem; margin-bottom: 5px;">
                                                        <strong>{{ game.name | default('Unknown Game') }}</strong><br>
                                                        <small class="text-muted">{{ game.rating }}/10 ‚Ä¢ {{ game.platform | default('Unknown Platform') }}</small>
                                                    </li>
                                                {% else %}
                                                    <li class="no-data-message">No releases found for selected period.</li>
                                                {% endfor %}
                                                {% if recent_releases | length > 15 %}
                                                    <li class="text-muted" style="font-size: 0.8rem; text-align: center; margin-top: 10px;">
                                                        ... and {{ (recent_releases | length) - 15 }} more releases
                                                    </li>
                                                {% endif %}
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <!-- Recent Top Rated Games -->
                                <div class="col-md-6">
                                    <div class="card">
                                        {% if active_tab == 'operational' %}
                                            {% set op_years = request.args.getlist('op_years') %}
                                            {% if op_years %}
                                                {% if op_years | length == 1 %}
                                                    <h5 class="card-title">Top Rated Games from {{ op_years[0] }}</h5>
                                                {% else %}
                                                    <h5 class="card-title">Top Rated Games ({{ op_years | min }}-{{ op_years | max }})</h5>
                                                {% endif %}
                                            {% elif year_range and year_range[0] == year_range[1] %}
                                                <h5 class="card-title">Top Rated Games from {{ year_range[0] }}</h5>
                                            {% elif year_range %}
                                                <h5 class="card-title">Top Rated Games ({{ year_range[0] }}-{{ year_range[1] }})</h5>
                                            {% else %}
                                                <h5 class="card-title">Top Rated Recent Games</h5>
                                            {% endif %}
                                        {% else %}
                                            <h5 class="card-title">Top Rated Recent Games</h5>
                                        {% endif %}
                                        <ul class="list-unstyled">
                                            {% for game in top_rated_recent[:10] %}
                                                <li style="color: #8be9fd;"><strong>{{ loop.index }}.</strong> {{ game.name | default('Unknown Game') }} ({{ game.rating }}/10, {{ game.release_year }})</li>
                                            {% else %}
                                                <li class="no-data-message">No recent games found.</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Platform Performance Row -->
                            <div class="row">
                                <!-- Platform Performance Table -->
                        <div class="col-md-12">
                            <div class="card">
                                        <h5 class="card-title">Platform Performance Metrics</h5>
                                        <div style="max-height: 300px; overflow-y: auto;">
                                            <table class="table table-dark table-sm">
                                                <thead>
                                                    <tr>
                                                        <th>Platform</th>
                                                        <th>Games</th>
                                                        <th>Avg Rating</th>
                                                        <th>Range</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for platform in platform_performance[:15] %}
                                                        <tr>
                                                            <td style="color: #8be9fd;">{{ platform.platform }}</td>
                                                            <td>{{ platform.total_games }}</td>
                                                            <td>{{ platform.avg_rating }}</td>
                                                            <td>{{ platform.rating_range }}</td>
                                                        </tr>
                                                    {% else %}
                                                        <tr><td colspan="4" class="no-data-message">No platform data available.</td></tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                            </div>
                        </div>
                    </div>
                            </div>

                            <!-- Operational Charts Row 1 -->
                            <div class="row">
                                <!-- Rating Trends Chart -->
                                <div class="col-md-6">
                                    <div class="card">
                                        <h5 class="card-title">Rating Trends by Month</h5>
                                        <div class="chart-container">
                                            <canvas id="ratingTrendsChart"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Monthly Release Activity Chart -->
                                <div class="col-md-6">
                                    <div class="card">
                                        <h5 class="card-title">Monthly Release Activity</h5>
                                        <div class="chart-container">
                                            <canvas id="monthlyActivityChart"></canvas>
                </div>
            </div>
        </div>
    </div>

                            <!-- Operational Charts Row 2 -->
                            <div class="row">
                                <!-- Platform Performance Chart -->
                                <div class="col-md-12">
                                    <div class="card">
                                        <h5 class="card-title">Platform Performance Overview</h5>
                                        <div class="chart-container">
                                            <canvas id="platformPerformanceChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tactical Dashboard Tab -->
                        <div class="tab-pane fade {% if active_tab == 'tactical' %}show active{% endif %}" id="tactical-dashboard" role="tabpanel">
                            <!-- Enhanced Developer Performance KPIs Row -->
                            <div class="row justify-content-center mb-4">
                                <!-- Top Performing Studio Type KPI -->
                                <div class="col-md-4">
                                    <div class="card" style="min-height: 150px;">
                                        <h5 class="card-title">Top Performing Studio Type</h5>
                                        <div class="big-number">{{ tactical_kpis.top_studio_type.name }}</div>
                                        <p class="text-center text-muted">{{ tactical_kpis.top_studio_type.performance_tier }} Tier</p>
                                        <small class="text-center text-info d-block">{{ tactical_kpis.top_studio_type.avg_replay_rate }}% replay rate</small>
                                    </div>
                                </div>

                                <!-- Strongest Gaming Country KPI -->
                                <div class="col-md-4">
                                    <div class="card" style="min-height: 150px;">
                                        <h5 class="card-title">Strongest Gaming Country</h5>
                                        <div class="big-number">{{ tactical_kpis.strongest_country.name[:12] }}{% if tactical_kpis.strongest_country.name|length > 12 %}...{% endif %}</div>
                                        <p class="text-center text-muted">{{ tactical_kpis.strongest_country.market_strength }} Market</p>
                                        <small class="text-center text-info d-block">{{ tactical_kpis.strongest_country.total_developers }} developers</small>
                                    </div>
                                </div>

                                <!-- Trending Insight KPI -->
                                <div class="col-md-4">
                                    <div class="card" style="min-height: 150px;">
                                        <h5 class="card-title">{{ tactical_kpis.trending_insight.category }}</h5>
                                        <div class="big-number">{{ tactical_kpis.trending_insight.value[:15] }}{% if tactical_kpis.trending_insight.value|length > 15 %}...{% endif %}</div>
                                        <p class="text-center text-muted">Trend: {{ tactical_kpis.trending_insight.trend|title }}</p>
                                        <small class="text-center text-success d-block">üî• Industry leader</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Enhanced Developer Performance Charts Container -->
                            <div class="tactical-charts-container">
                                <!-- Developer Performance Charts Row 1 -->
                                <div class="row">
                                    <!-- üìä Developer Performance Metrics - Horizontal Grouped Bar Chart -->
                                    <div class="col-md-6">
                                        <div class="card">
                                            <h5 class="card-title">Developer Performance Metrics</h5>
                                            <div class="chart-container">
                                                <canvas id="tacticalChart1"></canvas>
                                            </div>
                                            <small class="text-muted">Retention, Experience, and Market Reach by Studio Type</small>
                                        </div>
                                    </div>

                                    <!-- üåç Developer Geographic Distribution - Dual Y-Axis Chart -->
                                    <div class="col-md-6">
                                        <div class="card">
                                            <h5 class="card-title">Developer Geographic Distribution</h5>
                                            <div class="chart-container">
                                                <canvas id="tacticalChart2"></canvas>
                                            </div>
                                            <small class="text-muted">Developer Count (bars) vs Average Replay Rate (line)</small>
                                        </div>
                                    </div>
                                </div>

                                <!-- Developer Performance Charts Row 2 -->
                                <div class="row">
                                    <!-- üéÆ Top-Rated Games by Country - Horizontal Bar Chart -->
                                    <div class="col-md-6">
                                        <div class="card">
                                            <h5 class="card-title">Top-Rated Games by Country</h5>
                                            <div class="chart-container">
                                                <canvas id="tacticalChart3"></canvas>
                                            </div>
                                            <small class="text-muted">Highest-rated games from each country with developer details</small>
                                        </div>
                                    </div>

                                    <!-- üéØ Developer Maturity vs Performance - Grouped Vertical Bar Chart -->
                                    <div class="col-md-6">
                                        <div class="card">
                                            <h5 class="card-title">Developer Maturity vs Performance</h5>
                                            <div class="chart-container">
                                                <canvas id="tacticalChart4"></canvas>
                                            </div>
                                            <small class="text-muted">Average Replay Rate by Maturity Level and Studio Type</small>
                                        </div>
                                    </div>
                                </div>

                                <!-- Developer Performance Charts Row 3 -->
                                <div class="row">
                                    <!-- üß™ Replay Rate Distribution by Studio Type - Grouped Bar Chart -->
                                    <div class="col-md-6">
                                        <div class="card">
                                            <h5 class="card-title">Replay Rate Distribution by Studio Type</h5>
                                            <div class="chart-container">
                                                <canvas id="tacticalChart5"></canvas>
                                            </div>
                                            <small class="text-muted">Min, Average, and Max replay rates per studio type</small>
                                        </div>
                                    </div>

                                    <!-- üß± Country √ó Studio Type Matrix - Enhanced Visualizations -->
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <h5 class="card-title mb-0">Country √ó Studio Type Matrix</h5>
                                                <select id="matrixVisualizationType" class="form-select form-select-sm" style="width: auto;">
                                                    <option value="heatmap">Heatmap</option>
                                                    <option value="groupedBar">Grouped Bars</option>
                                                    <option value="stackedColumn">Stacked %</option>
                                                </select>
                                            </div>
                                            <div class="chart-container">
                                                <canvas id="tacticalChart6"></canvas>
                                            </div>
                                            <small class="text-muted" id="matrixChartDescription">Color-encoded grid showing developer count by country and studio type</small>
                                        </div>
                                    </div>
                                </div>

                                <!-- Developer Profile Table Row -->
                                <div class="row">
                                    <div class="col-md-12">
                                        <!-- üì¶ Developer Profile Table will be dynamically inserted here -->
                                        <!-- The table container will be created by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Game Trends Dashboard Tab -->
                        <div class="tab-pane fade {% if active_tab == 'game-trends' %}show active{% endif %}" id="game-trends-dashboard" role="tabpanel">
                            <div class="row mb-4">
                                <div class="col-12">
                                    <!-- Genre Tag Bar -->
                                    <div class="d-flex flex-row flex-nowrap overflow-auto mb-4" style="gap: 0.5rem;">
                                        <span class="badge bg-secondary genre-tag active" data-genre="all" style="font-size:1rem; padding:0.7em 1.2em; cursor:pointer;">All</span>
                                        {% for genre in game_trends_data.genres %}
                                            <span class="badge bg-secondary genre-tag" data-genre="{{ genre.name }}" style="font-size:1rem; padding:0.7em 1.2em; cursor:pointer;">{{ genre.name }}</span>
                                        {% endfor %}
                                    </div>
                                    <!-- Popular Right Now -->
                                    <h4 class="mb-3">Popular Right Now</h4>
                                    <div class="d-flex flex-row flex-nowrap overflow-auto mb-4" style="gap: 1rem;">
                                        {% for game in game_trends_data.popular %}
                                            <div class="card game-card" data-genres="{{ game.genres | map(attribute='name') | join(',') }}" style="min-width:200px; max-width:220px; cursor:pointer;">
                                                <img src="{{ game.cover.url }}" class="card-img-top" alt="{{ game.name }}">
                                                <div class="card-body p-2">
                                                    <h6 class="card-title mb-1">{{ game.name }}</h6>
                                                    <small class="text-muted">{{ game.genres[0].name if game.genres else '' }}</small><br>
                                                    <small>Rating: {{ game.rating | round(1) if game.rating else 'N/A' }}</small>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    <!-- Most Anticipated -->
                                    <h4 class="mt-4 mb-3">Most Anticipated</h4>
                                    <div class="row mb-4" style="gap: 1rem;">
                                        {% for game in game_trends_data.anticipated %}
                                            <div class="col-md-3 col-6">
                                                <div class="card h-100 text-white game-card" data-genres="{{ game.genres | map(attribute='name') | join(',') }}" style="background-image:url('{{ game.cover.url }}'); background-size:cover; background-position:center; min-height:180px; cursor:pointer;">
                                                    <div class="card-img-overlay d-flex flex-column justify-content-end" style="background:rgba(0,0,0,0.5);">
                                                        <h5 class="card-title">{{ game.name }}</h5>
                                                        <div><small>{{ game.first_release_date | int | datetimeformat }}</small></div>
                                                        <div class="countdown" data-date="{{ game.first_release_date }}"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    <!-- Recent Critics Reviews -->
                                    <h4 class="mt-4 mb-3">Recent Critics Reviews</h4>
                                    <div class="row mb-4">
                                        {% for game in game_trends_data.recently_reviewed %}
                                            <div class="col-md-4 col-12 mb-3">
                                                <div class="card h-100 text-white game-card" data-genres="{{ game.genres | map(attribute='name') | join(',') }}" style="background-image:url('{{ game.cover.url }}'); background-size:cover; background-position:center; min-height:120px; cursor:pointer;">
                                                    <div class="card-img-overlay d-flex flex-column justify-content-end" style="background:rgba(0,0,0,0.4);">
                                                        <h6 class="card-title mb-1">{{ game.name }}</h6>
                                                        <small>{{ game.genres[0].name if game.genres else '' }}</small>
                                                        <div class="fw-bold">{{ (game.rating * 10) | round(0) if game.rating else 'N/A' }}%</div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    <!-- Recently Released, Coming Soon, Most Anticipated Lists -->
                                    <div class="row mt-4">
                                        <div class="col-md-4 col-12">
                                            <h5>Recently Released</h5>
                                            <ul class="list-unstyled">
                                                {% for game in game_trends_data.recently_released %}
                                                    <li><span class="fw-bold">{{ game.name }}</span> <span class="text-muted">{{ game.date }}</span></li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                        <div class="col-md-4 col-12">
                                            <h5>Coming Soon</h5>
                                            <ul class="list-unstyled">
                                                {% for game in game_trends_data.coming_soon %}
                                                    <li><span class="fw-bold">{{ game.name }}</span> <span class="text-muted">{{ game.date }}</span></li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                        <div class="col-md-4 col-12">
                                            <h5>Most Anticipated</h5>
                                            <ul class="list-unstyled">
                                                {% for game in game_trends_data.most_anticipated_list %}
                                                    <li><span class="fw-bold">{{ game.name }}</span> <span class="text-muted">{{ game.date }}</span></li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pixel Profits Dashboard Tab -->
                        <div class="tab-pane fade {% if active_tab == 'pixel-profits' %}show active{% endif %}" id="pixel-profits-dashboard" role="tabpanel">
                            <div class="row mb-4">
                                <div class="col-12">
                                </div>
                            </div>
                            <!-- KPIs -->
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <div class="card kpi-card shadow rounded-4 border-0 bg-dark text-white">
                                        <div class="card-body text-center">
                                            <h5 class="card-title text-info fw-bold">Total Revenue</h5>
                                            <p class="display-3 fw-bold text-success" id="pixelProfitsTotalRevenue">${{ tactical_sales_data.total_revenue | default(0) | round(0) | int }}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card kpi-card shadow rounded-4 border-0 bg-dark text-white">
                                        <div class="card-body text-center">
                                            <h5 class="card-title text-info fw-bold">Total Units Sold</h5>
                                            <p class="display-3 fw-bold text-warning" id="pixelProfitsTotalUnits">{{ tactical_sales_data.total_units | default(0) | int }}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card kpi-card shadow rounded-4 border-0 bg-dark text-white">
                                        <div class="card-body text-center">
                                            <h5 class="card-title text-info fw-bold">Average Price per Unit</h5>
                                            <p class="display-3 fw-bold text-primary" id="pixelProfitsAvgPrice">${{ tactical_sales_data.avg_price | default(0) | round(2) }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Revenue Over Time Chart -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="card shadow rounded-4 border-0">
                                        <div class="card-body">
                                            <h5 class="card-title text-info fw-bold">Revenue Over Time</h5>
                                            <div class="chart-container" style="min-height:320px;">
                                                <canvas id="revenueOverTimeChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card shadow rounded-4 border-0">
                                        <div class="card-body">
                                            <h5 class="card-title text-info fw-bold">Units Sold by Month</h5>
                                            <div class="chart-container" style="min-height:320px;">
                                                <canvas id="unitsSoldByMonthChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Top Performers -->
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <div class="card shadow rounded-4 border-0">
                                        <div class="card-body">
                                            <h5 class="card-title text-info fw-bold">Top 10 Games by Revenue</h5>
                                            <div class="chart-container" style="min-height:260px;">
                                                <canvas id="topGamesByRevenueChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card shadow rounded-4 border-0">
                                        <div class="card-body">
                                            <h5 class="card-title text-info fw-bold">Top Platforms by Units Sold</h5>
                                            <div class="chart-container" style="min-height:260px;">
                                                <canvas id="topPlatformsByUnitsChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card shadow rounded-4 border-0">
                                        <div class="card-body">
                                            <h5 class="card-title text-info fw-bold">Best-Selling Genres</h5>
                                            <div class="chart-container" style="min-height:260px;">
                                                <canvas id="bestSellingGenresChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="card shadow rounded-4 border-0">
                                        <div class="card-body">
                                            <h5 class="card-title text-info fw-bold">Price Sensitivity by Region</h5>
                                            <div class="chart-container" style="min-height:260px;">
                                                <canvas id="priceSensitivityByRegionChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card shadow rounded-4 border-0">
                                        <div class="card-body">
                                            <h5 class="card-title text-info fw-bold">Revenue by Region</h5>
                                            <div class="chart-container" style="min-height:260px;">
                                                <canvas id="revenueByRegionChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="card shadow rounded-4 border-0">
                                        <div class="card-body">
                                            <h5 class="card-title text-info fw-bold">Revenue vs Units Sold Correlation</h5>
                                            <div class="chart-container" style="min-height:260px;">
                                                <canvas id="revenueVsUnitsChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card shadow rounded-4 border-0">
                                        <div class="card-body">
                                            <h5 class="card-title text-info fw-bold">Platform √ó Genre Matrix</h5>
                                            <div class="chart-container" style="min-height:260px;">
                                                <canvas id="platformGenreMatrixChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="card shadow rounded-4 border-0">
                                        <div class="card-body">
                                            <h5 class="card-title text-info fw-bold">Platform Sales Share</h5>
                                            <div class="chart-container" style="min-height:260px;">
                                                <canvas id="platformSalesShareChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card shadow rounded-4 border-0">
                                        <div class="card-body">
                                            <h5 class="card-title text-info fw-bold">Sales Velocity Post-Release</h5>
                                            <div class="chart-container" style="min-height:260px;">
                                                <canvas id="salesVelocityChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard JavaScript Files - Load before data initialization -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='js/charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/advanced-charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/data-init.js') }}"></script>
    
    <!-- Data passed from Flask backend -->
    <script>
        // Initialize data from server and start the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            const serverData = {
                stats: {{ stats | safe_tojson | safe }},
                topGames: {{ top_games | safe_tojson | safe }},
                platformCounts: {{ platform_counts | safe_tojson | safe }},
                genreCounts: {{ genre_counts | safe_tojson | safe }},
                gamesPerYear: {{ games_per_year | safe_tojson | safe }},
                publisherCounts: {{ publisher_counts | safe_tojson | safe }},
                avgRatingPlatform: {{ avg_rating_platform | safe_tojson | safe }},
                avgRatingDeveloper: {{ avg_rating_developer | safe_tojson | safe }},
                
                // Enhanced analytics data
                directorAnalytics: {{ director_analytics | safe_tojson | safe }},
                gameTypeDistribution: {{ game_type_distribution | safe_tojson | safe }},
                ratingDistribution: {{ rating_distribution | safe_tojson | safe }},
                votesAnalytics: {{ votes_analytics | safe_tojson | safe }},
                mostVotedGames: {{ most_voted_games | safe_tojson | safe }},
                collectionSummary: {{ collection_summary | safe_tojson | safe }},
                
                // Operational dashboard data
                recentReleases: {{ recent_releases | safe_tojson | safe }},
                ratingTrends: {{ rating_trends | safe_tojson | safe }},
                monthlyActivity: {{ monthly_activity | safe_tojson | safe }},
                platformPerformance: {{ platform_performance | safe_tojson | safe }},
                topRatedRecent: {{ top_rated_recent | safe_tojson | safe }},
                
                // Tactical dashboard data
                tacticalSankeyData: {{ tactical_sankey_data | safe_tojson | safe }},
                tacticalVennData: {{ tactical_venn_data | safe_tojson | safe }},
                tacticalChordData: {{ tactical_chord_data | safe_tojson | safe }},
                tacticalDumbbellData: {{ tactical_dumbbell_data | safe_tojson | safe }},
                tacticalMarimekkoData: {{ tactical_marimekko_data | safe_tojson | safe }},
                tacticalDeveloperProfiles: {{ tactical_developer_profiles | safe_tojson | safe }},
                tacticalMatrixData: {{ tactical_matrix_data | safe_tojson | safe }},
                tacticalSalesData: {{ tactical_sales_data | safe_tojson | safe }},
                
                // Lifecycle dashboard data
                lifecycleSurvivalData: {{ lifecycle_survival_data | safe_tojson | safe }},
                lifecycleRidgelineData: {{ lifecycle_ridgeline_data | safe_tojson | safe }},
                lifecycleTimelineData: {{ lifecycle_timeline_data | safe_tojson | safe }},
                lifecycleHexbinData: {{ lifecycle_hexbin_data | safe_tojson | safe }},
                lifecycleParallelData: {{ lifecycle_parallel_data | safe_tojson | safe }},
                
                // Evolution dashboard data
                evolutionStreamData: {{ evolution_stream_data | safe_tojson | safe }},
                evolutionBubbleData: {{ evolution_bubble_data | safe_tojson | safe }},
                evolutionHexbinData: {{ evolution_hexbin_data | safe_tojson | safe }},
                evolutionParallelData: {{ evolution_parallel_data | safe_tojson | safe }},
                evolutionTreeData: {{ evolution_tree_data | safe_tojson | safe }},
                gameTrendsData: {{ game_trends_data | safe_tojson | safe }}
            };
            
            // Initialize data and start dashboard
            initializeData(serverData);
        });
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Genre tag filtering
    const genreTags = document.querySelectorAll('.genre-tag');
    const gameCards = document.querySelectorAll('.game-card');
    genreTags.forEach(tag => {
        tag.addEventListener('click', function() {
            genreTags.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            const genre = this.getAttribute('data-genre');
            gameCards.forEach(card => {
                const genres = card.getAttribute('data-genres').split(',');
                if (genre === 'all' || genres.includes(genre)) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    });
    // Countdown timer for Most Anticipated
    function updateCountdowns() {
        document.querySelectorAll('.countdown').forEach(el => {
            const date = parseInt(el.getAttribute('data-date')) * 1000;
            const now = new Date().getTime();
            let diff = Math.max(0, date - now);
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            diff -= days * (1000 * 60 * 60 * 24);
            const hours = Math.floor(diff / (1000 * 60 * 60));
            diff -= hours * (1000 * 60 * 60);
            const minutes = Math.floor(diff / (1000 * 60));
            diff -= minutes * (1000 * 60);
            const seconds = Math.floor(diff / 1000);
            el.innerHTML = `<span style='font-size:1.2em;'>${days}d ${hours}h ${minutes}m ${seconds}s</span>`;
        });
    }
    setInterval(updateCountdowns, 1000);
    updateCountdowns();
    // Clickable game cards (demo: alert game name)
    document.querySelectorAll('.game-card').forEach(card => {
        card.addEventListener('click', function() {
            alert('Game: ' + this.querySelector('.card-title').innerText);
        });
    });
    </script>
</body>
</html> 