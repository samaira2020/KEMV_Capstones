<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Game Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h3>Filter Data</h3>
            <div class="filter-section">
                <label for="genre-filter">Select Genre(s):</label>
                <select id="genre-filter" multiple>
                    {% for genre in all_genres %}
                        <option value="{{ genre }}">{{ genre }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-section">
                <label for="platform-filter">Select Platform(s):</label>
                <select id="platform-filter" multiple>
                    {% for platform in all_platforms %}
                        <option value="{{ platform }}">{{ platform }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-section">
                <label for="year-range">Select Release Year Range:</label>
                <div>
                    From: <input type="number" id="year-start" value="{{ min_year_full }}" min="{{ min_year_full }}" max="{{ max_year_full }}">
                    To: <input type="number" id="year-end" value="{{ max_year_full }}" min="{{ min_year_full }}" max="{{ max_year_full }}">
                </div>
            </div>
             <button id="apply-filters-btn">Apply Filters</button>
        </div>

        <div class="main-content">
            <h1>Studio Performance Overview</h1>

            <div class="key-insights">
                <h3>Key Insights</h3>
                <div class="kpis">
                    <div class="kpi">
                        <h4>Total Games</h4>
                        <p>{{ total_games }}</p>
                    </div>
                    <div class="kpi">
                        <h4>Top Publisher</h4>
                        <p>{{ top_publisher }} ({{ top_publisher_count }} games)</p>
                    </div>
                </div>

                <div class="highly-rated-games">
                    <h3>Most Highly Rated Games</h3>
                    <ul>
                        {% for game in top_rated_games_list %}
                            <li>{{ loop.index }}. {{ game.Title }} <strong>{{ "%.1f" | format(game.Rating) }}</strong></li>
                        {% else %}
                            <li>No highly rated games found for the selected filters.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <hr>

            <div class="general-visualizations">
                <h3>General Visualizations</h3>
                <div class="viz-row">
                    <div id="games-per-year-chart" class="chart-container"></div>
                    <div id="game-share-publisher-chart" class="chart-container"></div>
                </div>
                <div class="viz-row">
                     <div id="top-publishers-chart" class="chart-container"></div>
                     <div id="avg-rating-platform-chart" class="chart-container"></div>
                </div>
            </div>

             <hr>

            <div class="deep-dive-analysis">
                 <h3>Deep Dive Analysis</h3>
                 <div id="avg-rating-developer-chart" class="chart-container"></div>
            </div>

            <div class="filtered-data-table">
                <h3>Filtered Data Table</h3>
                <table>
                    <thead>
                        <tr>
                            {% if data %}
                                {% for key in data[0].keys() %}
                                    <th>{{ key }}</th>
                                {% endfor %}
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in data %}
                            <tr>
                                {% for value in item.values() %}
                                    <td>{{ value }}</td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Embed chart data as JSON -->
    <script id="games-per-year-data" type="application/json">{{ games_per_year_data | safe }}</script>
    <script id="game-share-pub-data" type="application/json">{{ game_share_pub_data | safe }}</script>
    <script id="top-publishers-data" type="application/json">{{ top_publishers_data | safe }}</script>
    <script id="avg-rating-platform-data" type="application/json">{{ avg_rating_platform_data | safe }}</script>
    <script id="avg-rating-dev-data" type="application/json">{{ avg_rating_dev_data | safe }}</script>

    <script src="{{ url_for('static', filename='js/DS.js') }}"></script>
</body>
</html> 